---
title: '[R] Low-Budget High-Res Mapping with R for Not-for-Profit Print'
author: fubits
date: '2018-04-19'
slug: r-low-budget-high-res-mapping-with-r-for-not-for-profit-print
categories:
  - Rstats
  - Mapping
tags:
  - Map
  - CC0
  - Publishing
  - Print
lastmod: '2018-05-20T14:11:53+02:00'
keywords: []
description: ''
comment: no
toc: no
autoCollapseToc: no
postMetaInFooter: no
hiddenFromHomePage: no
contentCopyright: no
reward: no
mathjax: no
mathjaxEnableSingleDollar: no
mathjaxEnableAutoNumber: no
hideHeaderAndFooter: no
flowchartDiagrams:
  enable: no
  options: ''
sequenceDiagrams:
  enable: no
  options: ''
---



<p><img src="/img/map_final_v20_96dpi.png" title="#MyFirstMap" alt="(Spoiler: final version of the map)" style="width:100.0%" /> (“Presented at CODE/GEO/GRAPHIC, Berlin, 19 April 2018”)</p>
<p>(This is my first ever “how-to”, so please be so kind and point me to any errors and feel free to help me improve my code and approach!)</p>
<div id="setting" class="section level2">
<h2>1. Setting</h2>
<p>Once upon a time (and long before I learned about the <a href="https://twitter.com/hashtag/Tidyverse?src=hash">tidyverse</a> and %&gt;%), a colleague from a not-for-profit org asked for help with a map for a book. The conversation may or may not have sounded like that:</p>
<blockquote>
<p><em>We need a map for a book but we don’t have a budget.</em></p>
</blockquote>
<blockquote>
<p><em>And we need the map to be based on license-free material (no CC, no Leaflet, no OSM).</em></p>
</blockquote>
<blockquote>
<p><em>And it will be printed in black &amp; white.</em></p>
</blockquote>
<blockquote>
<p><em>And we need some states to be grouped in four regions in total.</em></p>
</blockquote>
<blockquote>
<p><em>And you know that the editors work with MS Word…</em></p>
</blockquote>
</div>
<div id="workflow" class="section level2">
<h2>2. Workflow</h2>
<p>“Simple” 3-step-process (actually 4):</p>
<ul>
<li>find Public Domain / CC-0 geodata (vector &amp; raster)</li>
<li>render the geodata as SVG</li>
<li>polish SVG in Illustrator / <strong>Affinity</strong> Designer et al.</li>
<li>(fit SVG to PDF page)</li>
</ul>
<p>How hard could that be, right?</p>
<div class="figure">
<img src="/img/monkeyuser_everytime.png" title="#Everytime" alt="(c) Monkey User" style="width:100.0%" />
<p class="caption">(c) Monkey User</p>
</div>
<div id="packages" class="section level3">
<h3>2.1 Packages</h3>
<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggrepel)
library(maps)
library(ggthemes)
library(rasterVis)
library(dplyr)
library(maptools)
library(sp)
# library(rnaturalearth) # &lt;- source for geodata, but pkg masks some needed f()</code></pre>
</div>
<div id="geodata-world-map-data-from-natural-earth" class="section level3">
<h3>2.2 Geodata: World Map Data from Natural Earth</h3>
<p><em>“Natural Earth is a public domain map dataset available at 1:10m, 1:50m, and 1:110 million scales. Featuring tightly integrated vector and raster data, with Natural Earth you can make a variety of visually pleasing, well-crafted maps with cartography or GIS software.”</em> <a href="http://www.naturalearthdata.com/">Natural Earth</a></p>
<div id="base-map-admin-0-level" class="section level4">
<h4>Base Map (Admin-0 Level)</h4>
<p>Let’s first import the geodata and check the basemap.</p>
<pre class="r"><code>world &lt;- rnaturalearth::countries110
plot(world)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Ugh, not so pretty, right? But you have to start somewhere…</p>
<p><strong>Spoiler: Some Objects – which were only mentioned later on – are missing at Admin-0 level.</strong></p>
</div>
<div id="fetch-non-admin-0-elements-guam-singapore" class="section level4">
<h4>(-&gt; Fetch Non-Admin-0 Elements (Guam &amp; Singapore))</h4>
<pre class="r"><code># countries10 &lt;- rnaturalearth::ne_download(scale = 10,
#                                           type = &#39;countries&#39;,
#                                           category = &#39;cultural&#39;)
# save(countries10, file = &quot;GIS_NPO_Data/countries10.rda&quot;)
load(&quot;../../data/GIS_NPO_Data/countries10.rda&quot;)</code></pre>
</div>
<div id="wheres-guam" class="section level4">
<h4>Where’s Guam?</h4>
<pre class="r"><code># First, let&#39;s search for Guam:
# &quot;Guam&quot; %in% rnaturalearth::countries110$SOVEREIGNT #&gt; FALSE, not &quot;souvereign&quot;
# Let&#39;s search below Admin-0 level within rnaturalearth::ne_states() 
# world.sub &lt;- rnaturalearth::ne_states()
# head(world.sub, 1) # &gt; either $name or $geounit
# &quot;Guam&quot; %in% world.sub$geonunit #&gt; TRUE (vs. $name &lt;- might be cruical for some)
Guam &lt;- rnaturalearth::ne_states(geounit = &#39;guam&#39;)
Guam$category &lt;- &quot;D&quot; # 4 regions A-D, as requested by colleague
plot(Guam)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="wheres-singapore" class="section level4">
<h4>Where’s Singapore?</h4>
<pre class="r"><code>#&gt; &quot;Singapore&quot; %in% rnaturalearth::countries110$SOVEREIGNT is FALSE, so apparently,
# it is a souvereign state, but as a city-state to granular for the 1:110m data.
# Let&#39;s search in the 1:10m data

Singapore &lt;- countries10[countries10$SOVEREIGNT == &#39;Singapore&#39;,]
# &quot;Singapore&quot; %in% world.sub$geonunit #&gt; is also TRUE, while
# &quot;Guam&quot; %in% countries10$SOVEREIGNT is FALSE
# Caution: Scope of data from countries110 &amp; countries10 might differ!
Singapore$category &lt;- &quot;C&quot;
plot(Singapore)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
</div>
<div id="assemble-the-regions" class="section level3">
<h3>2.3 Assemble the regions</h3>
<div id="china" class="section level4">
<h4>China</h4>
<pre class="r"><code>asia.china &lt;- world[world$sovereignt == &#39;China&#39;,]
asia.china$category &lt;- &quot;A&quot;
plot(asia.china)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="eastern-asia-subregion-minus-china-mongolia" class="section level4">
<h4>Eastern Asia (== subregion minus China &amp; Mongolia )</h4>
<pre class="r"><code>asia.east &lt;- world[world$subregion == &#39;Eastern Asia&#39; &amp;
                     world$sovereignt != &#39;Mongolia&#39; &amp;
                     world$sovereignt != &#39;China&#39;,]
asia.east$category &lt;- &quot;D&quot;
plot(asia.east)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="south-eastern-asia" class="section level4">
<h4>South-Eastern Asia</h4>
<pre class="r"><code>asia.seast &lt;- world[world$subregion == &#39;South-Eastern Asia&#39;,]
asia.seast$category &lt;- &quot;C&quot;
plot(asia.seast)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="central-and-south-asia" class="section level4">
<h4>Central and South Asia</h4>
<pre class="r"><code>asia.censouth &lt;- world[world$region_wb == &#39;South Asia&#39; |
                         world$subregion == &#39;Central Asia&#39; |
                         world$sovereignt == &#39;Mongolia&#39; |
                         world$sovereignt == &#39;Russia&#39;,]
asia.censouth$category &lt;- &quot;B&quot;
plot(asia.censouth)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-9-1.png" width="672" /> <strong>Why Russia, why?</strong> (cf. <a href="https://twitter.com/HalukaMB/status/974674444970020867">Thread</a> &amp; <a href="https://twitter.com/HalukaMB/status/982306518522527744">Solution</a> by <a href="https://twitter.com/HalukaMB">Haluka</a> )</p>
</div>
<div id="solution-set-left-bbox-border-to-clip-russias-overlapping-tail" class="section level4">
<h4>Solution: Set left BBOX-Border to clip Russia’s overlapping tail</h4>
<pre class="r"><code>leftBorder &lt;- 25
asia.censouth@bbox[1] &lt;- leftBorder
plot(asia.censouth)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="consolidate-the-core" class="section level4">
<h4>Consolidate the core</h4>
<pre class="r"><code>asia.core &lt;-  spRbind(
                spRbind(
                  spRbind(asia.china, asia.east),
                     asia.seast),
                        asia.censouth) # or just %&gt;% next time :)
asia.core@bbox[1] &lt;- leftBorder
plot(asia.core)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="consolidate-the-rest" class="section level4">
<h4>Consolidate the rest</h4>
<div id="preview" class="section level5">
<h5>(Preview)</h5>
<pre class="r"><code>asia.rest &lt;- world[world$region_un == &quot;Asia&quot; &amp;
                     world$sovereignt != &#39;China&#39; | 
                     world$region_un == &quot;Oceania&quot; | 
                     world$region_un == &quot;Africa&quot; |
                     world$region_un == &quot;Europe&quot;,]
asia.rest@bbox[1] &lt;- leftBorder
plot(asia.rest)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
</div>
<div id="remove-the-core" class="section level4">
<h4>Remove the Core</h4>
<pre class="r"><code>asia.rest &lt;- subset.data.frame(asia.rest,
                              !(asia.rest$sovereignt %in% asia.core$sovereignt))
asia.rest@bbox[1] &lt;- leftBorder
plot(asia.rest)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
</div>
<div id="convert-spatial-dataframe-to-a-tidy-dataframe" class="section level3">
<h3>2.4 Convert spatial dataframe to a tidy dataframe</h3>
<p>(this was done before geom_sf and ggsf where introduced. There might exist a more elegant solution right now, esp. with ggplot.)</p>
<div id="tidy-the-vector-data" class="section level4">
<h4>Tidy the vector data</h4>
<pre class="r"><code>asia.core@data$id &lt;- row.names(asia.core@data)
Singapore@data$id &lt;- row.names(Singapore@data)
Guam@data$id &lt;- row.names(Guam@data)
asia.main &lt;- broom::tidy(asia.core)
asia.main &lt;- dplyr::left_join(asia.main, asia.core@data, by = &#39;id&#39;)
head(asia.main, 1)</code></pre>
<pre><code>##       long      lat order  hole piece group id scalerank      featurecla
## 1 127.6574 49.76027     1 FALSE     1  30.1 30         1 Admin-0 country
##   labelrank sovereignt sov_a3 adm0_dif level    type admin adm0_a3
## 1         2      China    CH1        1     2 Country China     CHN
##   geou_dif geounit gu_a3 su_dif subunit su_a3 brk_diff  name name_long
## 1        0   China   CHN      0   China   CHN        0 China     China
##   brk_a3 brk_name brk_group abbrev postal                  formal_en
## 1    CHN    China      &lt;NA&gt;  China     CN People&#39;s Republic of China
##   formal_fr note_adm0 note_brk name_sort name_alt mapcolor7 mapcolor8
## 1      &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;     China     &lt;NA&gt;         4         4
##   mapcolor9 mapcolor13    pop_est gdp_md_est pop_year lastcensus gdp_year
## 1         4          3 1338612970    7973000       NA       2010       NA
##                    economy             income_grp wikipedia fips_10 iso_a2
## 1 3. Emerging region: BRIC 3. Upper middle income        NA    &lt;NA&gt;     CN
##   iso_a3 iso_n3 un_a3 wb_a2 wb_a3 woe_id adm0_a3_is adm0_a3_us adm0_a3_un
## 1    CHN    156   156    CN   CHN     NA        CHN        CHN         NA
##   adm0_a3_wb continent region_un    subregion           region_wb name_len
## 1         NA      Asia      Asia Eastern Asia East Asia &amp; Pacific        5
##   long_len abbrev_len tiny homepart category
## 1        5          5   NA        1        A</code></pre>
</div>
<div id="create-centered-country-labels" class="section level4">
<h4>Create centered Country Labels</h4>
<pre class="r"><code>centroids.df &lt;- as.data.frame(coordinates(asia.core)) # returns centered points
centroids.df$sovereignt &lt;- asia.core$sovereignt # add country names

# I had to include Guam and Singapore only after I already rendered the core
# map, so this is my rather awkward work-around to include subsequently
sing.centroids.df &lt;- as.data.frame(coordinates(Singapore))
sing.centroids.df$sovereignt &lt;- Singapore$SOVEREIGNT
centroids.df &lt;- rbind(centroids.df, sing.centroids.df)
Guam.centroids.df &lt;- as.data.frame(coordinates(Guam))
Guam.centroids.df$sovereignt &lt;- Guam$name
centroids.df &lt;- rbind(centroids.df, Guam.centroids.df)

# rename the colnames
names(centroids.df) &lt;- c(&quot;Long&quot;, &quot;Lat&quot;, &quot;Name&quot;)
head(centroids.df, 1)</code></pre>
<pre><code>##        Long      Lat  Name
## 30 103.8654 36.60943 China</code></pre>
</div>
</div>
<div id="relief-raster" class="section level3">
<h3>2.5 Relief Raster</h3>
<div id="get-the-relief-raster-file" class="section level4">
<h4>Get the Relief Raster File</h4>
<pre class="r"><code># Either:
# physics &lt;- rnaturalearth::ne_download(scale = 50, category = &#39;raster&#39;,
#                                       type = &#39;NE2_50M_SR_W&#39;, load = TRUE)

# OR:
# Download from: http://www.naturalearthdata.com/downloads/50m-raster-data/
# Here: NE2, shaded relief, water: http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/raster/NE2_50M_SR_W.zip
relief.world &lt;- raster(&quot;../../data/NE2_50M_SR_W.tif&quot;) # 170 MB file
plot(relief.world)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="if-needed-reduce-raster-resolution" class="section level4">
<h4>(If needed: Reduce Raster Resolution)</h4>
<pre class="r"><code># reduce resolution by 50% (I didn&#39;t do it since we want high-res for print)
# s2 &lt;- aggregate(s, fact = 2)
# plot(s2)</code></pre>
</div>
<div id="crop-the-raster-file" class="section level4">
<h4>Crop the Raster File</h4>
<pre class="r"><code># deprecated:
# manually select the box for the region with mouse pointer -&gt; quick but bad!!!
# s &lt;- raster::select(relief)
# plot(s)

# OR:
# Crop around dataframe
# relief.sub &lt;- crop(relief, extent(asia.rest))

# OR
# Clean &amp; easy: just define the extend of the box
box &lt;- extent(25, 155, -25, 60) # how to calculate ratio (i.e. 1: 1,48)?
relief.boxcrop &lt;- crop(relief.world, box)
plot(relief.boxcrop)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="raster-for-the-core-regions" class="section level4">
<h4>Raster for the core regions</h4>
<pre class="r"><code># Mask everything apart from the core regions terrain
# relief.land &lt;- raster::mask(relief.boxcrop, asia.core) # mask {E} != asia.core
# save(relief.land, file = &quot;GIS_NPO_Data/relief_land.rda&quot;)
load(&quot;../../data/GIS_NPO_Data/relief_land.rda&quot;)
plot(relief.land)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="convert-core-raster-to-spdf-to-df" class="section level4">
<h4>Convert core raster to SPDF to DF</h4>
<pre class="r"><code># Raster to SPDF
relief.land_spdf &lt;- as(relief.land, &quot;SpatialPixelsDataFrame&quot;)
# SPDF to DF (for ggplot)
relief.land_df &lt;- as.data.frame(relief.land_spdf) %&gt;% 
  rename(value = `NE2_50M_SR_W`)
head(relief.land_df, 1)</code></pre>
<pre><code>##   value     x        y
## 1   113 29.05 59.98333</code></pre>
</div>
<div id="raster-for-the-rest-oceans-terrain" class="section level4">
<h4>Raster for the rest (oceans &amp; terrain)</h4>
<pre class="r"><code># relief.meer &lt;- raster::mask(relief.boxcrop, asia.core, inverse=TRUE) # maskiert alles == asia.core
# save(relief.meer, file = &quot;GIS_NPO_Data/relief_meer.rda&quot;)
load(&quot;../../data/GIS_NPO_Data/relief_meer.rda&quot;)
plot(relief.meer)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code># reliefplot2 &lt;- crop(reliefplot2, box)
# plot(reliefplot2)</code></pre>
</div>
<div id="convert-2nd-raster-to-df" class="section level4">
<h4>Convert 2nd raster to DF</h4>
<pre class="r"><code>relief.meer_spdf &lt;- as(relief.meer, &quot;SpatialPixelsDataFrame&quot;)
relief.meer_df &lt;- as.data.frame(relief.meer_spdf) %&gt;% 
  rename(value = `NE2_50M_SR_W`)
head(relief.meer_df, 1)</code></pre>
<pre><code>##   value        x        y
## 1   112 25.01667 59.98333</code></pre>
</div>
</div>
</div>
<div id="results" class="section level2">
<h2>3. Results</h2>
<div id="preview-with-default-colors" class="section level3">
<h3>Preview with default colors</h3>
<pre class="r"><code>ggplot() +
  geom_polygon(data = fortify(asia.main), alpha = 0.5,
               aes(x = long, y = lat, group = group,
                   fill = asia.main$category),
               color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(asia.rest), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               fill = &quot;grey89&quot;, color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(Singapore), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  geom_polygon(data = fortify(Guam), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  coord_equal(ratio = 1, xlim = c(25, 149), ylim = c(54.9, -25)) + # cropped
  theme_map() +
  theme(legend.position = &quot;none&quot;) +
  geom_text_repel(data = fortify(centroids.df),
                aes(label = Name, size = 12, x = Long, y = Lat),
                segment.colour = NA)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="map-without-rasterterrain" class="section level3">
<h3>Map without raster/terrain</h3>
<pre class="r"><code># Better approach:  Setting dimensions for {r}-snippet according to requirements
# for print would be much better for serialisation and polishing in Illustrator et al.
map &lt;- ggplot() +
 # raster
  # geom_raster(data = relief.land_df, aes(x = x, y = y, alpha = value)) +
  # geom_raster(data = relief.meer_df, aes(x = x, y = y, alpha = value)) +
  # scale_alpha(name = &quot;&quot;, range = c(0.4, 0), guide = F) + #  &quot;alpha hack&quot;
  geom_polygon(data = fortify(asia.rest), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               fill = &quot;grey89&quot;, color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(asia.main), alpha = 0.5,
               aes(x = long, y = lat, group = group, fill = asia.main$category),
               color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(Singapore), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  geom_polygon(data = fortify(Guam), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  # scale_fill_grey(start = 0.2, end = 0.8) + 
  scale_fill_manual(values = c(&quot;#f7f7f7&quot;, &quot;#cccccc&quot;, &quot;#969696&quot;, &quot;#525252&quot;)) + 
  # 4-class greya from colorbrewer.org: #f7f7f7 #cccccc #969696 #525252
  coord_equal(ratio = 1, xlim = c(25,149), ylim = c(54.9, -25)) + # cropped
  theme_map() +
  theme(legend.position = &quot;none&quot;) +
  geom_text_repel(data = fortify(centroids.df),
                  aes(label = Name, size = 12, x = Long, y = Lat),
                  segment.colour = NA)
plot(map)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="map-with-full-raster-core-and-rest" class="section level3">
<h3>Map with full raster (core and rest)</h3>
<p>(~3 min rendering time with Intel i7 7500 / 16 GB / SSD)</p>
<pre class="r"><code>map &lt;- ggplot() +
 # raster
  geom_raster(data = relief.land_df, aes(x = x, y = y, alpha = value)) +
  geom_raster(data = relief.meer_df, aes(x = x, y = y, alpha = value)) +
  scale_alpha(name = &quot;&quot;, range = c(0.4, 0), guide = F) + # &quot;alpha hack&quot;
  geom_polygon(data = fortify(asia.rest), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               fill = &quot;grey89&quot;, color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(asia.main), alpha = 0.5,
               aes(x = long, y = lat, group = group,
                   fill = asia.main$category),
               color = &quot;white&quot;, size = 1) +
  geom_polygon(data = fortify(Singapore), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  geom_polygon(data = fortify(Guam), alpha = 0.5,
               aes(x = long, y = lat, group = group),
               color = &quot;white&quot;, fill = &quot;red&quot;, size = 1) +
  # scale_fill_grey(start = 0.2, end = 0.8) + 
  scale_fill_manual(values = c(&quot;#f7f7f7&quot;, &quot;#cccccc&quot;, &quot;#969696&quot;, &quot;#525252&quot;)) + 
  # 4-class grey from colorbrewer.org: #f7f7f7 #cccccc #969696 #525252
  coord_equal(ratio = 1, xlim = c(25,149), ylim = c(54.9, -25)) + # cropped
  theme_map() +
  theme(legend.position = &quot;none&quot;) +
  geom_text_repel(data = fortify(centroids.df),
                  aes(label = Name, size = 12, x = Long, y = Lat),
                  segment.colour = NA)
# save(map, file = &quot;output/map_w_raster_full.rda&quot;)
# load(&quot;output/map_w_raster_full.rda&quot;)
plot(map)</code></pre>
<p><img src="/post/2018-04-19-r-low-budget-high-res-mapping-with-r-for-not-for-profit-print_files/figure-html/unnamed-chunk-25-1.png" width="672" /> Not perfect, but sufficient for post-processing the output SVG with a vector processing app. One issue I wasn’t able to dissolve, is the different interpretations of the left border set to 25. While the raster definitively is cropped to 25°, the polygons extend beyond that. I’m quite sure that this is because of <a href="https://en.wikipedia.org/wiki/Kaliningrad">Kaliningrad</a>, so I guess it should be possible to ID the <strong>exclave</strong> by “String %in% $var” and exclude it from the dataframe. I might test that later.</p>
<p>Since the map was going to be printed in BW, I decided to provide at least some relieve with regards to the overloaded color scheme. Remember: While ColorBrewer recommends a max of 3 color levels for BW, this map has 4 shades of grey for the 4 core regions, 1 color for water (and borders), and another grey shade for countries which are not part of the core region. Add black for the labels and we end up with 7 colors. So leaving water areas and the rest of the world without relief, while highlighting the core regions by underlying them with a relief kind of works here. Don’t @ me :)</p>
</div>
<div id="final-processing-of-output-svg-in-affinity-photo-designer" class="section level3">
<h3>Final processing of output SVG in Affinity Photo / Designer</h3>
<div class="figure">
<img src="/img/map_affinity.jpg" title="Processing the SVG" alt="Processing the SVG in Affinity" style="width:100.0%" />
<p class="caption"><em>“Processing the SVG in Affinity”</em></p>
</div>
<p>Basically, I just scaled the SVG to 300 dpi, changed the fonts and slightly readjusted the alpha levels of the regions. That’s it. We’re done here. (PS: We’re not, since someone has to blog about it and maybe even hold it as a lighting talk at a cool workshop)</p>
</div>
</div>
<div id="lessons-learned" class="section level2">
<h2>4. Lessons Learned</h2>
<ul>
<li><p>(<a href="https://xkcd.com/977/">Map Projections, anyone?</a>)</p></li>
<li><p>Print != “JPEG”. We need high-res data and have to check for artifacts (i.e. small islands which might be rendered with 1px and then be printed as “corns”)</p></li>
<li><p>Demand <strong>precise</strong> specifics:</p>
<p>Full list of ALL features</p>
<p>Print <strong>dimensions</strong> for the map (absoulte in cm/inch or ratio)</p>
<p>Publication/<strong>layout</strong> dimensions (page size, font size, orientation/layout, keep in mind 300dpi)</p>
<p>Check whether there’s some <strong>Corporate Design</strong> Manual (i.e. for fonts &amp; colors)</p>
<p>Will there be a <strong>caption</strong>? -&gt; If yes, leave some space for it.</p>
<p>For printing on white paper: do we need a black <strong>border</strong> around the map?</p>
<p><strong>Probably best way to start with is to ask for a <em>sketch</em>!</strong></p></li>
<li><p>Show-case your first <strong>prototype</strong> as early as possible -&gt; early error detection</p></li>
<li><p>Let your “client” double-check geopolitical <strong>pitfalls</strong> (think Crimea!)</p></li>
<li><p>Black &amp; white printing: For the sake of <strong>inclusion</strong> and quality: do not use more than 3 shades of grey (plus white)</p></li>
<li><p>For colorized printing: Think about those 10% with <strong>reduced red/green vision</strong> (-&gt; consult <a href="http://colorbrewer2.org">ColorBrewer2</a>)</p></li>
<li><p>Explicitly agree on <strong>credits</strong> for your work (and actually, try to agree on a CC-licensing)</p></li>
<li><p>Encountered some problems and found a way out? –&gt; <strong>Share your knowledge</strong>: Blog / GitHub / Present / Discuss / Revise</p></li>
<li><p>Send the final version as a pre-rendered <strong>robust</strong> PDF (but still include the SVG).</p></li>
</ul>
<p><strong>Thanks for reading!</strong></p>
<div class="figure">
<img src="/img/sheldon_maps.jpg" title="Fun with ~~flags~~ maps" alt="Fun with flags maps" style="width:100.0%" />
<p class="caption"><em>“Fun with <del>flags</del> maps”</em></p>
</div>
</div>
<div id="some-sources" class="section level2">
<h2>5. (Some) sources</h2>
<p>These links are some of the key sources, which helped me to get started with mapping in R.</p>
<ul>
<li><p><a href="https://ikashnitsky.github.io/">Ilya Kashnitsky’s Blog</a>, whose posts were the reason I started to map with R on my own</p></li>
<li><p><a href="https://timogrossenbacher.ch/2016/12/beautiful-thematic-maps-with-ggplot2-only/">Timo Grossenbacher</a>, who documented how to include raster file in ggplot</p></li>
<li><p><a href="https://academy.datawrapper.de/article/117-color-palette-for-your-map">Lisa C. Rost</a>, Design Guru at DataWrapper</p></li>
<li><p><a href="http://colorbrewer2.org">Team Color Brewer 2.0</a>, tool for generating color palettes for all kinds of use</p></li>
</ul>
</div>
